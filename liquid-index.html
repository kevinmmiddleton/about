<script>
  (function () {
    const menu = document.getElementById('menu');
    const toggle = document.getElementById('menu-toggle');
    const headerName = document.getElementById('header-name');
    const hero = document.getElementById('hero');

    // Toggle mobile menu
    function openMenu() {
      menu.classList.add('flex');          // your CSS uses #menu.flex
      toggle.setAttribute('aria-expanded', 'true');
      document.addEventListener('click', onOutsideClick);
      document.addEventListener('keydown', onEsc);
    }
    function closeMenu() {
      menu.classList.remove('flex');
      toggle.setAttribute('aria-expanded', 'false');
      document.removeEventListener('click', onOutsideClick);
      document.removeEventListener('keydown', onEsc);
    }
    function onOutsideClick(e) {
      if (!menu.contains(e.target) && !toggle.contains(e.target)) closeMenu();
    }
    function onEsc(e) {
      if (e.key === 'Escape') closeMenu();
    }

    toggle.setAttribute('aria-controls', 'menu');
    toggle.setAttribute('aria-expanded', 'false');
    toggle.addEventListener('click', () => {
      menu.classList.contains('flex') ? closeMenu() : openMenu();
    });

    // Close menu when a link is clicked (useful on mobile)
    menu.querySelectorAll('a').forEach(a =>
      a.addEventListener('click', () => closeMenu())
    );

    // Show name in header after hero is scrolled past
    const heroBottom = () => (hero ? hero.offsetTop + hero.offsetHeight : 120);
    function onScroll() {
      if (window.scrollY > heroBottom() - 80) {
        headerName.classList.remove('hidden');
      } else {
        headerName.classList.add('hidden');
      }
    }
    onScroll();
    window.addEventListener('scroll', onScroll, { passive: true });

    // Fix state on resize (e.g., going from mobile to desktop)
    let lastIsMobile = window.innerWidth < 768;
    window.addEventListener('resize', () => {
      const isMobile = window.innerWidth < 768;
      if (lastIsMobile !== isMobile) {
        closeMenu(); // reset menu state
        lastIsMobile = isMobile;
      }
    });

    // Optional: smooth-scroll offset for fixed header
    document.querySelectorAll('a[href^="#"]').forEach(link => {
      link.addEventListener('click', e => {
        const id = link.getAttribute('href');
        const target = document.querySelector(id);
        if (!target) return;
        e.preventDefault();
        const headerHeight = document.querySelector('header')?.offsetHeight || 64;
        const y = target.getBoundingClientRect().top + window.pageYOffset - headerHeight - 8;
        window.scrollTo({ top: y, behavior: 'smooth' });
      });
    });
  })();
</script>
